<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Cosmic DevSpace</title>
  <link rel="stylesheet" href="./css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .admin-header {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(150, 90, 255, 0.3);
    }
    
    .admin-header h1 {
      margin: 0;
      font-size: 2.5rem;
      background: linear-gradient(135deg, #965aff, #2bc4fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      border: 1px solid rgba(150, 90, 255, 0.2);
      transition: transform 0.3s, border-color 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      border-color: rgba(150, 90, 255, 0.5);
    }
    
    .stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 0.9rem;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .stat-card .value {
      font-size: 2.5rem;
      font-weight: bold;
      background: linear-gradient(135deg, #965aff, #2bc4fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(150, 90, 255, 0.3);
      color: #fff;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }
    
    .tab-btn:hover {
      background: rgba(150, 90, 255, 0.2);
      border-color: #965aff;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #965aff, #2bc4fa);
      border-color: #965aff;
    }
    
    .tab-content {
      display: none;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid rgba(150, 90, 255, 0.2);
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .data-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }
    
    .data-table thead th {
      text-align: left;
      padding: 15px;
      background: rgba(150, 90, 255, 0.2);
      color: #fff;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85rem;
      letter-spacing: 1px;
    }
    
    .data-table thead th:first-child {
      border-radius: 10px 0 0 10px;
    }
    
    .data-table thead th:last-child {
      border-radius: 0 10px 10px 0;
    }
    
    .data-table tbody tr {
      background: rgba(255, 255, 255, 0.03);
      transition: all 0.3s;
    }
    
    .data-table tbody tr:hover {
      background: rgba(150, 90, 255, 0.1);
      transform: scale(1.01);
    }
    
    .data-table tbody td {
      padding: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .data-table tbody td:first-child {
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 10px 0 0 10px;
    }
    
    .data-table tbody td:last-child {
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 0 10px 10px 0;
    }
    
    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s;
      margin-right: 5px;
    }
    
    .btn-edit {
      background: linear-gradient(135deg, #2bc4fa, #1e90ff);
      color: #fff;
    }
    
    .btn-delete {
      background: linear-gradient(135deg, #ff568f, #ff2d55);
      color: #fff;
    }
    
    .btn-approve {
      background: linear-gradient(135deg, #00d4aa, #00b894);
      color: #fff;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .chart-container {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-success {
      background: rgba(0, 212, 170, 0.2);
      color: #00d4aa;
      border: 1px solid #00d4aa;
    }
    
    .badge-warning {
      background: rgba(255, 222, 138, 0.2);
      color: #fde68a;
      border: 1px solid #fde68a;
    }
    
    .badge-danger {
      background: rgba(255, 86, 143, 0.2);
      color: #ff568f;
      border: 1px solid #ff568f;
    }
    
    .badge-info {
      background: rgba(43, 196, 250, 0.2);
      color: #2bc4fa;
      border: 1px solid #2bc4fa;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2rem;
      color: #aaa;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.3;
    }
    
    .search-bar {
      margin-bottom: 20px;
    }
    
    .search-bar input {
      width: 100%;
      max-width: 400px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(150, 90, 255, 0.3);
      border-radius: 25px;
      color: #fff;
      font-size: 1rem;
    }
    
    .search-bar input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- Header -->
    <div class="admin-header">
      <h1>ðŸš€ Admin Control Panel</h1>
      <p style="margin: 10px 0 0 0; color: #aaa;">Welcome back, <span id="adminName">Space Commander</span>!</p>
    </div>
    
    <!-- Stats Overview -->
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <h3>Total Users</h3>
        <div class="value" id="totalUsers">0</div>
      </div>
      <div class="stat-card">
        <h3>Total Projects</h3>
        <div class="value" id="totalProjects">0</div>
      </div>
      <div class="stat-card">
        <h3>Blog Posts</h3>
        <div class="value" id="totalBlogs">0</div>
      </div>
      <div class="stat-card">
        <h3>Guestbook Entries</h3>
        <div class="value" id="totalGuestbook">0</div>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('analytics')">ðŸ“Š Analytics</button>
      <button class="tab-btn" onclick="switchTab('users')">ðŸ‘¥ Users</button>
      <button class="tab-btn" onclick="switchTab('projects')">ðŸš€ Projects</button>
      <button class="tab-btn" onclick="switchTab('blogs')">ðŸ“š Blogs</button>
      <button class="tab-btn" onclick="switchTab('guestbook')">ðŸ’¬ Guestbook</button>
      <button class="tab-btn" onclick="switchTab('contacts')">ðŸ“§ Contacts</button>
    </div>
    
    <!-- Tab Contents -->
    <div id="analyticsTab" class="tab-content active">
      <h2>Analytics Dashboard</h2>
      <div class="chart-container">
        <canvas id="visitsChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="engagementChart"></canvas>
      </div>
    </div>
    
    <div id="usersTab" class="tab-content">
      <h2>User Management</h2>
      <div class="search-bar">
        <input type="text" placeholder="Search users..." onkeyup="searchUsers(this.value)">
      </div>
      <div id="usersContent" class="loading">Loading users...</div>
    </div>
    
    <div id="projectsTab" class="tab-content">
      <h2>Project Management</h2>
      <div class="search-bar">
        <input type="text" placeholder="Search projects..." onkeyup="searchProjects(this.value)">
      </div>
      <div id="projectsContent" class="loading">Loading projects...</div>
    </div>
    
    <div id="blogsTab" class="tab-content">
      <h2>Blog Management</h2>
      <div class="search-bar">
        <input type="text" placeholder="Search blogs..." onkeyup="searchBlogs(this.value)">
      </div>
      <div id="blogsContent" class="loading">Loading blogs...</div>
    </div>
    
    <div id="guestbookTab" class="tab-content">
      <h2>Guestbook Moderation</h2>
      <div id="guestbookContent" class="loading">Loading entries...</div>
    </div>
    
    <div id="contactsTab" class="tab-content">
      <h2>Contact Messages</h2>
      <div id="contactsContent" class="loading">Loading contacts...</div>
    </div>
  </div>
  
  <script src="./js/api-client.js"></script>
  <script src="./js/app.js"></script>
  <script>
    // Check admin authentication
    function checkAuth() {
      const user = CosmicAPI.utils.getCurrentUser();
      if (!user || !CosmicAPI.utils.isAdmin()) {
        alert('Access denied! Admin privileges required.');
        window.location.href = '/login.html';
        return false;
      }
      document.getElementById('adminName').textContent = user.username;
      return true;
    }
    
    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // Load tab data
      switch(tabName) {
        case 'users': loadUsers(); break;
        case 'projects': loadProjects(); break;
        case 'blogs': loadBlogs(); break;
        case 'guestbook': loadGuestbook(); break;
        case 'contacts': loadContacts(); break;
      }
    }
    
    // Load overview stats
    async function loadStats() {
      try {
        const [users, projects, blogs, guestbook] = await Promise.all([
          CosmicAPI.users.getAll({ limit: 1 }),
          CosmicAPI.projects.getAll({ limit: 1 }),
          CosmicAPI.blog.getAll({ limit: 1 }),
          CosmicAPI.guestbook.getAll({ limit: 1 })
        ]);
        
        document.getElementById('totalUsers').textContent = users.data?.pagination?.totalItems || 0;
        document.getElementById('totalProjects').textContent = projects.data?.pagination?.totalItems || 0;
        document.getElementById('totalBlogs').textContent = blogs.data?.pagination?.totalItems || 0;
        document.getElementById('totalGuestbook').textContent = guestbook.data?.pagination?.totalItems || 0;
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }
    
    // Load users
    async function loadUsers() {
      try {
        const response = await CosmicAPI.users.getAll({ limit: 50 });
        const users = response.data?.users || [];
        
        const html = users.length ? `
          <table class="data-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Email</th>
                <th>Role</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${users.map(user => `
                <tr>
                  <td>${user.username}</td>
                  <td>${user.email}</td>
                  <td><span class="badge badge-${user.role === 'admin' ? 'danger' : 'info'}">${user.role}</span></td>
                  <td>${CosmicAPI.utils.formatDate(user.createdAt)}</td>
                  <td>
                    <button class="action-btn btn-edit" onclick="editUser('${user._id}')">Edit</button>
                    <button class="action-btn btn-delete" onclick="deleteUser('${user._id}')">Delete</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<div class="empty-state"><div class="empty-state-icon">ðŸ‘¥</div><p>No users found</p></div>';
        
        document.getElementById('usersContent').innerHTML = html;
      } catch (error) {
        document.getElementById('usersContent').innerHTML = '<p>Error loading users</p>';
      }
    }
    
    // Load projects
    async function loadProjects() {
      try {
        const response = await CosmicAPI.projects.getAll({ limit: 50 });
        const projects = response.data?.projects || [];
        
        const html = projects.length ? `
          <table class="data-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Status</th>
                <th>Views</th>
                <th>Likes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${projects.map(project => `
                <tr>
                  <td>${project.title}</td>
                  <td><span class="badge badge-info">${project.category}</span></td>
                  <td><span class="badge badge-success">${project.status}</span></td>
                  <td>${project.metrics?.views || 0}</td>
                  <td>${project.metrics?.likes || 0}</td>
                  <td>
                    <button class="action-btn btn-edit" onclick="editProject('${project._id}')">Edit</button>
                    <button class="action-btn btn-delete" onclick="deleteProject('${project._id}')">Delete</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<div class="empty-state"><div class="empty-state-icon">ðŸš€</div><p>No projects found</p></div>';
        
        document.getElementById('projectsContent').innerHTML = html;
      } catch (error) {
        document.getElementById('projectsContent').innerHTML = '<p>Error loading projects</p>';
      }
    }
    
    // Load blogs
    async function loadBlogs() {
      try {
        const response = await CosmicAPI.blog.getAll({ limit: 50 });
        const blogs = response.data?.blogs || [];
        
        const html = blogs.length ? `
          <table class="data-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Category</th>
                <th>Status</th>
                <th>Views</th>
                <th>Comments</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${blogs.map(blog => `
                <tr>
                  <td>${blog.title}</td>
                  <td><span class="badge badge-info">${blog.category}</span></td>
                  <td><span class="badge badge-${blog.status === 'published' ? 'success' : 'warning'}">${blog.status}</span></td>
                  <td>${blog.views || 0}</td>
                  <td>${blog.commentCount || 0}</td>
                  <td>
                    <button class="action-btn btn-edit" onclick="editBlog('${blog._id}')">Edit</button>
                    <button class="action-btn btn-delete" onclick="deleteBlog('${blog._id}')">Delete</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<div class="empty-state"><div class="empty-state-icon">ðŸ“š</div><p>No blog posts found</p></div>';
        
        document.getElementById('blogsContent').innerHTML = html;
      } catch (error) {
        document.getElementById('blogsContent').innerHTML = '<p>Error loading blogs</p>';
      }
    }
    
    // Load guestbook
    async function loadGuestbook() {
      try {
        const response = await CosmicAPI.guestbook.getAll({ limit: 50 });
        const entries = response.data?.entries || [];
        
        const html = entries.length ? `
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Message</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${entries.map(entry => `
                <tr>
                  <td>${entry.name}</td>
                  <td>${entry.message.substring(0, 50)}...</td>
                  <td><span class="badge badge-${entry.status === 'approved' ? 'success' : 'warning'}">${entry.status}</span></td>
                  <td>${CosmicAPI.utils.formatDate(entry.createdAt)}</td>
                  <td>
                    ${entry.status !== 'approved' ? `<button class="action-btn btn-approve" onclick="approveEntry('${entry._id}')">Approve</button>` : ''}
                    <button class="action-btn btn-delete" onclick="deleteEntry('${entry._id}')">Delete</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<div class="empty-state"><div class="empty-state-icon">ðŸ’¬</div><p>No guestbook entries found</p></div>';
        
        document.getElementById('guestbookContent').innerHTML = html;
      } catch (error) {
        document.getElementById('guestbookContent').innerHTML = '<p>Error loading guestbook</p>';
      }
    }
    
    // Load contacts
    async function loadContacts() {
      try {
        const response = await CosmicAPI.contact.getAll({ limit: 50 });
        const contacts = response.data?.contacts || [];
        
        const html = contacts.length ? `
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Subject</th>
                <th>Message</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              ${contacts.map(contact => `
                <tr>
                  <td>${contact.name}</td>
                  <td>${contact.email}</td>
                  <td>${contact.subject}</td>
                  <td>${contact.message.substring(0, 50)}...</td>
                  <td>${CosmicAPI.utils.formatDate(contact.createdAt)}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        ` : '<div class="empty-state"><div class="empty-state-icon">ðŸ“§</div><p>No contact messages found</p></div>';
        
        document.getElementById('contactsContent').innerHTML = html;
      } catch (error) {
        document.getElementById('contactsContent').innerHTML = '<p>Error loading contacts</p>';
      }
    }
    
    // Delete functions
    async function deleteUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      try {
        await CosmicAPI.users.delete(id);
        loadUsers();
      } catch (error) {
        alert('Error deleting user');
      }
    }
    
    async function deleteProject(id) {
      if (!confirm('Are you sure you want to delete this project?')) return;
      try {
        await CosmicAPI.projects.delete(id);
        loadProjects();
      } catch (error) {
        alert('Error deleting project');
      }
    }
    
    async function deleteBlog(id) {
      if (!confirm('Are you sure you want to delete this blog post?')) return;
      try {
        await CosmicAPI.blog.delete(id);
        loadBlogs();
      } catch (error) {
        alert('Error deleting blog');
      }
    }
    
    async function deleteEntry(id) {
      if (!confirm('Are you sure you want to delete this entry?')) return;
      try {
        await CosmicAPI.guestbook.delete(id);
        loadGuestbook();
      } catch (error) {
        alert('Error deleting entry');
      }
    }
    
    // Initialize charts
    function initCharts() {
      // Visits chart
      const visitsCtx = document.getElementById('visitsChart').getContext('2d');
      new Chart(visitsCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Page Views',
            data: [120, 190, 130, 180, 220, 180, 250],
            borderColor: '#965aff',
            backgroundColor: 'rgba(150, 90, 255, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { color: '#fff' } }
          },
          scales: {
            y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
            x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
          }
        }
      });
      
      // Engagement chart
      const engagementCtx = document.getElementById('engagementChart').getContext('2d');
      new Chart(engagementCtx, {
        type: 'bar',
        data: {
          labels: ['Projects', 'Blogs', 'Guestbook', 'Comments'],
          datasets: [{
            label: 'Engagement',
            data: [45, 28, 62, 34],
            backgroundColor: [
              'rgba(150, 90, 255, 0.6)',
              'rgba(43, 196, 250, 0.6)',
              'rgba(255, 222, 138, 0.6)',
              'rgba(255, 86, 143, 0.6)'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { color: '#fff' } }
          },
          scales: {
            y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
            x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
          }
        }
      });
    }
    
    // Initialize
    if (checkAuth()) {
      loadStats();
      initCharts();
    }
  </script>
</body>
</html>
